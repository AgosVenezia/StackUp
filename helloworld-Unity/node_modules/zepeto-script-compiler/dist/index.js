(()=>{"use strict";var __webpack_modules__={919:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.walkSync=t.hasMember=t.hasStaticMember=t.findNode=t.patch=void 0;const s=i(747);const n=i(622);function patch(e,t,i){let s=e[t];e[t]=function(...e){return i.call(this,s.bind(this),...e)};return e}t.patch=patch;function findNode(e,t){const i=[e];while(i.length){const n=i.pop();if(!n)break;let a=n.getStart(e,true);let o=n.getEnd();if(t>=a&&t<=o){var s=n.getChildren(e);if(s.length==0)return n;i.push(...s)}}return null}t.findNode=findNode;function hasMemberWithBaseTypes(e,t,i){var s=i(e,t);if(s)return s;var n=e;if(n.checker&&e.symbol){e=n.checker.getDeclaredTypeOfSymbol(e.symbol);if(e&&e.isClassOrInterface()){var a=n.checker.getBaseTypes(e);if(a){for(const e of a){if(hasMemberWithBaseTypes(e,t,i))return e}}}}}function hasStaticMember(e,t){return hasMemberWithBaseTypes(e,t,((e,t)=>{if(e.symbol&&e.symbol.exports&&e.symbol.exports.has(t)){return e}}))}t.hasStaticMember=hasStaticMember;function hasMember(e,t){return hasMemberWithBaseTypes(e,t,((e,t)=>{if(e.symbol&&e.symbol.members&&e.symbol.members.has(t)){return e}}))}t.hasMember=hasMember;function*walkSync(e){const t=s.readdirSync(e,{withFileTypes:true});for(const i of t){if(i.isDirectory()){yield*walkSync(n.join(e,i.name))}else{yield n.join(e,i.name)}}}t.walkSync=walkSync},993:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.OperatorNames=void 0;const s=i(34);const n=i(919);const a=i(375);t.OperatorNames={[s.SyntaxKind.PlusToken]:"op_Addition",[s.SyntaxKind.MinusToken]:"op_Subtraction",[s.SyntaxKind.AsteriskToken]:"op_Multiply",[s.SyntaxKind.SlashToken]:"op_Division",[s.SyntaxKind.PlusEqualsToken]:"op_Addition",[s.SyntaxKind.MinusEqualsToken]:"op_Subtraction",[s.SyntaxKind.AsteriskEqualsToken]:"op_Multiply",[s.SyntaxKind.SlashEqualsToken]:"op_Division",[s.SyntaxKind.EqualsEqualsToken]:"op_Equality",[s.SyntaxKind.ExclamationEqualsToken]:"op_Inequality"};class BinaryExpressionExtension extends a.ExtensionBase{static patch(e,i){let a=e.getTypeChecker();var o=i;var l=o.createBinaryExpressionTrampoline;if(l){try{n.patch(o,"createBinaryExpressionTrampoline",((e,i,n,o,l,c,p)=>e(i,n,o,l,((e,i)=>{var n=t.OperatorNames[e.operatorToken.kind];if(n){if(i.skip==false){var o=i.typeStack[i.stackIndex];var l=i.typeStack[i.stackIndex+1];var p=BinaryExpressionExtension.getExtendedBinaryOperator(a,n,o,l);e.__ExtendedBinaryOperator=p;if(p){return p.returnType}}}else if(e.operatorToken.kind==s.SyntaxKind.EqualsToken&&s.isBinaryExpression(e.right)){var f=e.right;if(f.__ExtendedBinaryOperator){return f.__ExtendedBinaryOperator.returnType}}return c(e,i)}),p)))}catch(e){console.log(e)}}}static execute(e,i){if(s.isBinaryExpression(e)==false)return null;let n=e;let a=n.operatorToken.kind;var o=t.OperatorNames[a];if(!o)return null;let l=e.__ExtendedBinaryOperator;if(!e.__ExtendedBinaryOperator){return null}let c=l.returnType;if(!c||!l||!l.operator||!l.operator.valueDeclaration)return null;i.referencedAliasDeclarations.add(l.ownerType.symbol.name);var p;if(s.isMethodDeclaration(l.operator.valueDeclaration)&&s.isIdentifier(l.operator.valueDeclaration.name)){p=l.operator.valueDeclaration.name}else{p=s.factory.createIdentifier(o)}if(l.memberOperator){var f=s.visitEachChild(n,i.visitor,i.transformationContext);var u=i.transformationContext.factory;return u.createCallExpression(u.createPropertyAccessExpression(f.left,p),undefined,[f.right])}var y=e.getSourceFile();var d;if(y.locals){var m=y.locals.get(l.ownerType.symbol.escapedName);if(m&&m.declarations&&m.declarations.length){d=m.declarations[0].name}}if(!d){var x=e.getSourceFile();var h=x.imports;let t=l.ownerType.symbol;let n=undefined;let a;let o=[];while(t){o.unshift(t.name.replace(/['|"]/g,""));t=t.parent}a=o.shift();if(o.length>0){a=i.InsertImportDeclarations(a);d=s.factory.createPropertyAccessExpression(s.factory.createIdentifier(a),s.factory.createIdentifier(o.join(".")))}else{return null}}var f=s.visitEachChild(n,i.visitor,i.transformationContext);var u=i.transformationContext.factory;var g=u.createCallExpression(u.createPropertyAccessExpression(d,p),undefined,[f.left,f.right]);if(a==s.SyntaxKind.PlusEqualsToken||a==s.SyntaxKind.MinusEqualsToken||a==s.SyntaxKind.AsteriskEqualsToken||a==s.SyntaxKind.SlashEqualsToken){return u.createBinaryExpression(f.left,u.createToken(s.SyntaxKind.EqualsToken),g)}return g}static isTypeEqual(e,t){if(e==t)return true;if(e.symbol&&t.symbol){if(e.symbol==t.symbol)return true;if(e.symbol.valueDeclaration==t.symbol.valueDeclaration)return true}else if(e.flags==t.flags){if(e.id&&e.id==t.id)return true;if(e.intrinsicName&&e.intrinsicName==t.intrinsicName)return true}return false}static findMatchedBinaryOperator(e,t,i,a,o){t=n.hasStaticMember(t,i);if(t){var l=t.symbol.exports.get(i);if(l==null)return null;var c=l.getDeclarations();if(c){for(const t of c){if(s.isMethodDeclaration(t)){var p=t.parameters;if(p&&p.length==2){var f=p.map((t=>{var i=e.getTypeAtLocation(t.type);return i}));if(BinaryExpressionExtension.isTypeEqual(f[0],a)&&BinaryExpressionExtension.isTypeEqual(f[1],o)){return e.getTypeAtLocation(t.type)}}}}}}return null}static findEqualOperator(e,t){const i="Equals";let a=n.hasMember(t,i);if(a){var o=a.symbol.members.get(i);if(o==null)return null;var l=o.getDeclarations();if(l){for(const i of l){if(s.isMethodDeclaration(i)){var c=i.parameters;if(c&&c.length==1){var p=e.getTypeAtLocation(c[0].type);if(p.flags==1){var f=e.getTypeAtLocation(i.type);return{ownerType:t,returnType:f,operator:o,memberOperator:true}}}}}}}return null}static getExtendedBinaryOperator(e,t,i,s){i=e.getBaseTypeOfLiteralType(i);s=e.getBaseTypeOfLiteralType(s);var n=BinaryExpressionExtension.findMatchedBinaryOperator(e,i,t,i,s);if(n)return{ownerType:i,returnType:n,operator:i.symbol.exports.get(t)};n=BinaryExpressionExtension.findMatchedBinaryOperator(e,s,t,i,s);if(n)return{ownerType:s,returnType:n,operator:i.symbol.exports.get(t)}}}t.default=BinaryExpressionExtension},591:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.BuiltInDecorators=void 0;const s=i(34);const n=i(375);t.BuiltInDecorators=new Set(["NonSerialized","HideInInspector","SerializeField","Header","Space","Tooltip"]);class DecoratorExtension extends n.ExtensionBase{static execute(e,i){if(s.isDecorator(e)&&s.isPropertyDeclaration(e.parent)&&s.isCallExpression(e.expression)){var n=e.expression;if(s.isIdentifier(n.expression)&&t.BuiltInDecorators.has(n.expression.escapedText.toString())){return s.factory.createEmptyStatement()}}return null}}t.default=DecoratorExtension},652:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});const s=i(34);const n=i(919);const a=i(375);class ElementAccessExpressionExtension extends a.ExtensionBase{static execute(e,t){if(s.isBinaryExpression(e)){if(e.operatorToken.kind==s.SyntaxKind.EqualsToken&&s.isElementAccessExpression(e.left)){let i=e.left;let a=t.typeChecker.getTypeAtLocation(i.expression);if(t.typeChecker.isArrayType(a))return;let o="set_Item";if(n.hasMember(a,o)){let t=s.factory;return t.createCallExpression(t.createPropertyAccessExpression(i.expression,t.createIdentifier(o)),undefined,[i.argumentExpression,e.right])}}return}if(s.isElementAccessExpression(e)==false)return;let i=e;let a=t.typeChecker.getTypeAtLocation(i.expression);if(t.typeChecker.isArrayType(a))return;let o="get_Item";if(n.hasMember(a,o)){let e=s.factory;return e.createCallExpression(e.createPropertyAccessExpression(i.expression,e.createIdentifier(o)),undefined,[i.argumentExpression])}}}t.default=ElementAccessExpressionExtension},678:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});const s=i(34);const n=i(34);const a=i(919);const o=i(375);class EventHandlerExtension extends o.ExtensionBase{static patch(e,t){let i=e.getTypeChecker();a.patch(e,"getSemanticDiagnostics",((e,t,o)=>{var l=e(t,o);l=l.filter((e=>{if(e.code==2363){var t=a.findNode(e.file,e.start);while(t){if(s.isBinaryExpression(t)){if(t.operatorToken.kind==n.SyntaxKind.MinusEqualsToken&&n.isPropertyAccessExpression(t.left)){let e=i.getTypeAtLocation(t.left.expression);let s=`remove_${t.left.name.escapedText}`;if(a.hasStaticMember(e,s)||a.hasMember(e,s)){return false}}break}t=t.parent}}return true}));return l}))}static execute(e,t){if(n.isBinaryExpression(e)&&(e.operatorToken.kind==n.SyntaxKind.PlusEqualsToken||e.operatorToken.kind==n.SyntaxKind.MinusEqualsToken)&&n.isPropertyAccessExpression(e.left)){let o=t.typeChecker.getTypeAtLocation(e.left.expression);let l=(e.operatorToken.kind==n.SyntaxKind.PlusEqualsToken?"add_":"remove_")+e.left.name.escapedText;if(a.hasStaticMember(o,l)||a.hasMember(o,l)){let a=n.factory;let o=e;var i=n.visitEachChild(o,t.visitor,t.transformationContext);if(n.isPropertyAccessExpression(i.left)){var s=i.right;if(n.isArrowFunction(i.right)==false){s=a.createCallExpression(a.createPropertyAccessExpression(i.right,a.createIdentifier("bind")),undefined,[a.createThis()])}return a.createCallExpression(a.createPropertyAccessExpression(i.left.expression,a.createIdentifier(l)),undefined,[s])}}}}}t.default=EventHandlerExtension},375:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.ExtensionBase=t.ExtensionContext=void 0;const s=i(34);const n=i(919);class ExtensionContext{constructor(e){this.symboleIdentifiers=new WeakMap;this.program=e;this.typeChecker=e.getTypeChecker();this.referencedAliasDeclarations=new Set;this.importDeclarations=new Map}InsertImportDeclarations(e){var t=`__${e}__`;if(this.importDeclarations.has(e)==false){var i=s.factory;var n=i.createImportDeclaration(undefined,undefined,i.createImportClause(false,undefined,i.createNamespaceImport(i.createIdentifier(t))),i.createStringLiteral(e));this.importDeclarations.set(e,n)}return t}updateImportDeclarations(e){if(this.importDeclarations&&this.importDeclarations.size>0){e=s.factory.updateSourceFile(e,[...this.importDeclarations.values(),...e.statements])}return e}visit(e){if(s.isImportSpecifier(e)||s.isNamespaceImport(e)){let t=this.typeChecker.getTypeAtLocation(e.name);if(t.symbol){this.symboleIdentifiers.set(t.symbol,e.name)}}}setTransformationContext(e){this.transformationContext=e;this.resolver=e.getEmitResolver();n.patch(this.resolver,"isReferencedAliasDeclaration",((e,t,i)=>{var n=e(t,i);if(n==false){var a;if(s.isImportClause(t)&&t.namedBindings&&s.isNamedImports(t.namedBindings)){var o=t.namedBindings.elements[0];a=this.typeChecker.getTypeAtLocation(o)}else if(s.isImportClause(t)&&t.namedBindings&&s.isNamespaceImport(t.namedBindings)){return true}else{try{a=this.typeChecker.getTypeAtLocation(t)}catch(e){}if(!a){console.error(s.SyntaxKind[t.kind],"not handled")}}if(a&&a.symbol&&this.referencedAliasDeclarations.has(a.symbol.name)){return true}}return n}))}isReferencedAliasDeclaration(e,t,i){var s=e(t,i);return s}}t.ExtensionContext=ExtensionContext;class ExtensionBase{static patch(e,t){}static execute(e,t){return null}}t.ExtensionBase=ExtensionBase},544:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});const s=i(34);const n=i(375);class ExtensionMethodExtension extends n.ExtensionBase{static execute(e,t){if(s.isCallExpression(e)&&s.isPropertyAccessExpression(e.expression)){var i=t.typeChecker.getSymbolAtLocation(e.expression);if(!i||!i.valueDeclaration)return;var n;var a=s.getJSDocTags(i.valueDeclaration);if(a&&a.length>0){for(let e=0;e<a.length;e++){const t=a[e];if(t.tagName.escapedText=="extension"){n=t.comment;break}}}if(!n)return;var o=s.factory;var l=[e.expression.expression];l=l.concat(e.arguments);return o.createCallExpression(o.createPropertyAccessExpression(o.createCallExpression(o.createIdentifier("$extension"),undefined,[o.createStringLiteral(n)]),e.expression.name),undefined,l)}}}t.default=ExtensionMethodExtension},937:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});const s=i(34);const n=i(375);const a=i(919);class FroLoopExtension extends n.ExtensionBase{static patch(e,t){a.patch(e,"getSemanticDiagnostics",((t,i,s)=>{let n=t(i,s);n=n.filter((t=>{if(t.code==2488){const i=a.findNode(t.file,t.start);if(this.IsIEnumerable(i,e.getTypeChecker())){return false}}return true}));return n}))}static execute(e,t){if(e.parent&&(s.isForOfStatement(e.parent)||s.isForInStatement(e.parent))){if(s.isIdentifier(e)||s.isPropertyAccessExpression(e)||s.isCallExpression(e)){if(this.IsIEnumerable(e,t.typeChecker)){return s.factory.createCallExpression(s.factory.createIdentifier("$IEnumerableToArray"),undefined,[s.factory.createIdentifier(e.getFullText())])}}}return null}static IsIEnumerable(e,t){const i=t.getTypeAtLocation(e);if(i){const e=i.symbol.escapedName.toString().split("$")[0];if(e=="IEnumerable"){return true}}return false}}t.default=FroLoopExtension},953:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});const s=i(34);const n=i(375);function IsMethodSignatureOrDeclaration(e){return s.isMethodDeclaration(e)||s.isMethodSignature(e)}class ElementAccessExpressionExtension extends n.ExtensionBase{static execute(e,t){if(s.isNewExpression(e)&&s.isIdentifier(e.expression)&&e.typeArguments&&e.typeArguments.length>0){var i=e.expression.escapedText.toString().split("$");if(i.length!=2)return;var n=parseInt(i[1]);if(e.typeArguments.length!=n)return;var a=s.factory;var o=[e.expression];for(let i=0;i<e.typeArguments.length;i++){const n=e.typeArguments[i];if(s.isTypeReferenceNode(n)&&s.isIdentifier(n.typeName)){var l=t.typeChecker.getTypeAtLocation(n.typeName);if(l.flags==s.TypeFlags.Object){o.push(n.typeName)}else{o.push(a.createCallExpression(a.createIdentifier("$typeof"),undefined,[a.createStringLiteral(n.typeName.escapedText.toString())]))}}}return a.createNewExpression(a.createParenthesizedExpression(a.createCallExpression(a.createIdentifier("$generic"),undefined,o)),undefined,e.arguments)}else if(s.isCallExpression(e)&&s.isPropertyAccessExpression(e.expression)&&e.typeArguments&&e.typeArguments.length>0){var c=t.typeChecker;var p=c.getSymbolAtLocation(e.expression);if(!p)return;var f=c.getResolvedSignature(e);if(!f||IsMethodSignatureOrDeclaration(f.declaration)==false)return;var u=f.declaration;if(IsMethodSignatureOrDeclaration(u)&&u.typeParameters){var y=u.typeParameters;var d=u.parameters||[];for(let i=0;i<p.declarations.length;i++){const n=p.declarations[i];if(n!=u&&IsMethodSignatureOrDeclaration(n)&&!n.typeParameters){if(n&&n.parameters&&n.parameters.length==d.length+1){var m=c.getTypeAtLocation(n.parameters[0].name);var x=m.symbol;if(!x)continue;var h=x.parent;if(m.symbol.name=="Type"&&h&&(h.name=="System"||h.name=='"System"')){var g=true;for(let e=0;e<d.length;e++){var v=c.getTypeAtLocation(d[e]);var E=c.getTypeAtLocation(n.parameters[e+1]);if(v!=E&&v.symbol!=E.symbol){if(v.aliasSymbol==E.aliasSymbol){if(E.aliasTypeArguments){var _=E.aliasTypeArguments;if(!_.find((e=>!e||e.intrinsicName!=="any")))continue}}g=false;break}}if(g){var T=e.arguments.slice(0);var S=e.typeArguments[0];var b;var k;if(s.isTypeQueryNode(S)){b=S.exprName}if(s.isTypeReferenceNode(S)){if(s.isIdentifier(S.typeName)){b=S.typeName}else if(s.isQualifiedName(S.typeName)){b=S.typeName.right;let e=t.InsertImportDeclarations(S.typeName.left.getFullText());k=s.factory.createIdentifier(e)}}if(b&&s.isIdentifier(b)){let i=c.getTypeAtLocation(b);let n=c.getTypeAtLocation(e.expression.expression);if(i.symbol)t.referencedAliasDeclarations.add(i.symbol.name);if(n.symbol)t.referencedAliasDeclarations.add(n.symbol.name);if(i.symbol&&i.symbol.flags==s.SymbolFlags.Interface)return;let a;if(k){a=s.factory.createCallExpression(s.factory.createIdentifier("$typeof"),undefined,[s.factory.createPropertyAccessExpression(k,b)])}else{a=s.factory.createCallExpression(s.factory.createIdentifier("$typeof"),undefined,[b])}T.unshift(a)}else if(!b){var D;if(S.kind==s.SyntaxKind.NumberKeyword){D=s.factory.createStringLiteral("System.Double")}else if(S.kind==s.SyntaxKind.StringKeyword){D=s.factory.createStringLiteral("System.String")}else if(S.kind==s.SyntaxKind.BooleanKeyword){D=s.factory.createStringLiteral("System.Boolean")}if(D){var C=s.factory.createCallExpression(s.factory.createIdentifier("$typeof"),undefined,[s.factory.createCallExpression(s.factory.createIdentifier("$typeof"),undefined,[D])]);T.unshift(C)}}return s.factory.createCallExpression(e.expression,undefined,T)}}}}}}return}}}t.default=ElementAccessExpressionExtension},555:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.extensions=void 0;const s=i(953);const n=i(993);const a=i(652);const o=i(678);const l=i(591);const c=i(544);const p=i(937);const f=[n.default,a.default,o.default,s.default,l.default,c.default,p.default];t.extensions=f},822:(e,t,i)=>{const s=i(555);const n=i(921);n.startServer();function init(e){console.log("init");function create(e){const t=Object.create(null);for(let i of Object.keys(e.languageService)){t[i]=(...t)=>{var s=e.languageService[i].apply(e.languageService,t);return s}}return t}var t=e.typescript.createProgram;e.typescript.createProgram=(...i)=>{var n=t.apply(e.typescript,i);for(const t of s.extensions){t.patch(n,e.typescript)}return n};return{create:create}}e.exports=init},289:(__unused_webpack_module,exports,__nccwpck_require__)=>{Object.defineProperty(exports,"__esModule",{value:true});exports.parseManifest=exports.Manifest=void 0;const module_1=__nccwpck_require__(282);const path=__nccwpck_require__(622);const ts=__nccwpck_require__(34);const DecoratorExtension_1=__nccwpck_require__(591);class Manifest{constructor(){this.properties=[]}}exports.Manifest=Manifest;function parseManifest(sourceFile,typeChecker){var manifest=new Manifest;for(let e=0;e<sourceFile.statements.length;e++){const t=sourceFile.statements[e];if(ts.isClassDeclaration(t)&&t.name){manifest.name=t.name.escapedText.toString();break}}if(!manifest.name){manifest.name=path.basename(sourceFile.fileName,".ts")}function getPropertyTypeName(type,propertyDeclarationType){if(type.intrinsicName){if(propertyDeclarationType&&ts.isTypeReferenceNode(propertyDeclarationType)&&ts.isIdentifier(propertyDeclarationType.typeName)){if(type.intrinsicName!=propertyDeclarationType.typeName.escapedText){return{type:propertyDeclarationType.typeName.escapedText.toString()}}}return{type:type.intrinsicName}}else{if(propertyDeclarationType&&ts.isArrayTypeNode(propertyDeclarationType)){var arrayType=typeChecker.getTypeAtLocation(propertyDeclarationType.elementType);var r=getPropertyTypeName(arrayType,propertyDeclarationType.elementType);r.isArray=true;return r}else if(type.symbol){var fullTypeName=[];var result={};var currentType=type.symbol;var isEnumModule=false;while(currentType){if(currentType.valueDeclaration){if(ts.isEnumDeclaration(currentType.valueDeclaration)&&currentType.parent&&currentType.parent.valueDeclaration&&ts.isSourceFile(currentType.parent.valueDeclaration)){try{var sourceCode=currentType.valueDeclaration.getFullText();var transpiled=module_1.Module.wrap(ts.transpile(sourceCode,{noEmitOnError:false}));let exports={};eval(transpiled)(exports);var allEnumValues=exports[currentType.escapedName];if(allEnumValues){var enumKeys=[];var enumValues=[];if(currentType.exports){currentType.exports.forEach(((e,t)=>{var i=t.toString();if(allEnumValues[i]!==undefined){enumKeys.push(t.toString());enumValues.push(allEnumValues[i])}}));result.enumKeys=enumKeys;result.enumValues=enumValues}}result.type=currentType.escapedName.toString();return result}catch(e){throw new Error("Enum Property Parse Error")}}}var name=currentType.escapedName.toString();if(currentType.flags==ts.SymbolFlags.ValueModule){fullTypeName.unshift(name.substring(1,name.length-1))}else{fullTypeName.unshift(name)}currentType=currentType.parent}result.type=fullTypeName.join(".");return result}}}function getProperties(e){const t=["Map"];var i=[];if(e.symbol&&e.symbol.escapedName!="ZepetoScriptBehaviour"&&e.symbol.members){e.symbol.members.forEach((e=>{if(e.valueDeclaration&&ts.isPropertyDeclaration(e.valueDeclaration)){var s=false;if(e.valueDeclaration.modifiers){for(let t=0;t<e.valueDeclaration.modifiers.length;t++){const i=e.valueDeclaration.modifiers[t];if(i.kind==ts.SyntaxKind.PrivateKeyword||i.kind==ts.SyntaxKind.ProtectedKeyword){s=true;break}}}var n=typeChecker.getTypeAtLocation(e.valueDeclaration);var a=getPropertyTypeName(n,e.valueDeclaration.type);if(a){const n=t.includes(a.type);a.name=e.escapedName.toString();a.initValue=getInitValue(e.valueDeclaration);var o=getAttributes(e.valueDeclaration);if(o&&o.length){a.attributes=o}if(n==false&&(s==false||a.attributes&&a.attributes.find((e=>e.name=="SerializeField")))){i.push(a)}}}}))}var s=typeChecker.getBaseTypes(e);if(s){for(const e of s){var n=getProperties(e);i=i.concat(n)}}return i}function getAttributes(e){let t=[];if(e.decorators){for(let s=0;s<e.decorators.length;s++){const n=e.decorators[s];if(ts.isCallExpression(n.expression)&&ts.isIdentifier(n.expression.expression)){var i=n.expression.expression;if(DecoratorExtension_1.BuiltInDecorators.has(i.escapedText.toString())){let e=n.expression.arguments;let s=e.map((e=>e.getText()));t.push({name:i.escapedText,args:s})}}}}return t}function getInitValue(e){const t=e.initializer;if(t){if(t.text){return[t.text]}if(t.name){return[t.name.escapedText]}if(t.elements){return t.elements.map((e=>e.text))}}}sourceFile.forEachChild((e=>{if(ts.isClassDeclaration(e)){var t=typeChecker.getTypeAtLocation(e);if(t.symbol&&t.symbol.escapedName==="default"){var i=getProperties(t);for(const e of i){manifest.properties.push(e)}}}}));return manifest}exports.parseManifest=parseManifest},921:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.startServer=void 0;const s=i(747);const n=i(622);const a=i(34);const o=i(555);const l=i(788);const c=i(289);const p=i(605);const f=i(919);const u=i(417);class FileVersion{constructor(){this.version=0}}class CompileResultFile{static from(e,t){var i=new CompileResultFile;i.fileName=e.name;i.source=e.text;i.errors=t||[];return i}}class CompilerServer{constructor(e){this._projectFile=e;a.getFileEmitOutput=this.getFileEmitOutput;this.files=new Map;this.servicesHost={getScriptFileNames:()=>this.ensureScriptFileNames(),getScriptVersion:e=>this.getFile(n.join(e)).version.toString(),getScriptSnapshot:e=>s.existsSync(e)?a.ScriptSnapshot.fromString(s.readFileSync(e).toString()):undefined,getCurrentDirectory:()=>process.cwd(),getCompilationSettings:()=>this._compilerOptions,getDefaultLibFileName:e=>a.getDefaultLibFilePath(e),fileExists:a.sys.fileExists,readFile:a.sys.readFile,readDirectory:a.sys.readDirectory,directoryExists:a.sys.directoryExists,getDirectories:a.sys.getDirectories};this.services=a.createLanguageService(this.servicesHost,a.createDocumentRegistry());this.server=p.createServer(this.onRequest.bind(this))}ensureScriptFileNames(){return Array.from(this.files.keys()).filter((e=>{if(s.existsSync(e)==false){this.files.delete(e);return false}return true}))}ensureCompilationSettings(){if(this.servicesHost.fileExists(this._projectFile)==false){return{}}else{var e=+s.statSync(this._projectFile).mtime;if(!this._compilerOptions||this._compilerOptionsVersion!=e){this._compilerOptionsVersion=e;var t=readConfig(a,this._projectFile,n.dirname(this._projectFile));this._compilerOptions=t.options;this._compilerOptions.noEmitOnError=true;this.files.clear()}}return this._compilerOptions}getFileEmitOutput(e,t,i,s,n,p){n={before:[l.createTransformer(e)]};for(const t of o.extensions){t.patch(e,a)}var f=new CompileResultFile;f.fileName=t.fileName;f.manifest=c.parseManifest(t,e.getTypeChecker());var u=e.emit(t,writeFile,s,i,n,p);f.errors=u.diagnostics.map((e=>{let t=a.flattenDiagnosticMessageText(e.messageText,"\n");if(e.file){let{line:i,character:s}=e.file.getLineAndCharacterOfPosition(e.start);return`${e.file.fileName} (${i+1},${s+1}): ${t}`}else{return t}}));var y=a;var d=y.FindAllReferences.Core.getReferencesForFileName(f.fileName,e,e.getSourceFiles());d=d.map((e=>{if(e.fileName)return e.fileName;var t=e.node.getSourceFile();return t.fileName}));return{result:f,references:d};function writeFile(e,t,i){f.source=t}}initialize(e){this.files.clear();if(e)e.forEach((e=>this.getFile(e)))}getFile(e){var t=this.files.get(e);if(!t){t=new FileVersion;this.files.set(e,t)}return t}checksumFile(e,t){return u.createHash(e).update(`${s.readFileSync(t,"utf-8")}#${t}`).digest("hex")}buildFiles(e){e=e.filter(this.servicesHost.fileExists);var t=new Map;for(const n of e){var i=s.statSync(n).mtime;t.set(n,i)}e=e.sort(((e,i)=>t.get(i)-t.get(e)));this.ensureCompilationSettings();for(const i of e){this.getFile(i).version=+t.get(i)||0}let n=new Set;return[].concat(...e.map((e=>this.emitFile(e,n))))}emitFile(e,t){if(!t)t=new Set;else if(t.has(e))return[];var i=Date.now();let s;try{s=this.services.getEmitOutput(e)}catch(t){s={result:{fileName:e,source:null,manifest:null,errors:[t.toString()]},references:[]}}console.log("emit ",Date.now()-i,"ms - ",e);i=Date.now();t.add(e);var n=[s.result];if(s.references){s.references.forEach((e=>{n=n.concat(this.emitFile(e,t))}))}return n}getErrors(e){let t=this.services.getSyntacticDiagnostics(e).concat(this.services.getSemanticDiagnostics(e));return t.map((e=>{let t=a.flattenDiagnosticMessageText(e.messageText,"\n");if(e.file){let{line:i,character:s}=e.file.getLineAndCharacterOfPosition(e.start);return`${e.file.fileName} (${i+1},${s+1}): ${t}`}else{return t}}))}listen(e,t){this.server.requestTimeout=1e3*60*15;this.server.listen(e,t)}onRequest(e,t){var i=new URL(e.url,"http://localhost");if(i.pathname=="/health"){t.writeHead(200,{"Content-Type":"application/json"});t.write("OK");t.end()}else if(i.pathname=="/files"){t.writeHead(200,{"Content-Type":"application/json"});t.write(JSON.stringify({files:this.ensureScriptFileNames()}));t.end()}else if(e.method=="POST"){var s="";e.on("data",(e=>s+=e));e.on("end",(()=>{try{t.writeHead(200,{"Content-Type":"application/json"});var e=JSON.parse(s);if(e.files){if(i.pathname=="/init"){if(e.projectFile)this._projectFile=e.projectFile;this.initialize(e.files)}else if(i.pathname=="/build"){var n=this.buildFiles(e.files);if(i.searchParams.get("debug")){t.write(n[0].source)}else{t.write(JSON.stringify({files:n}))}}}t.end()}catch(e){t.writeHead(400);t.write(e.stack?e.stack:e.toString());t.end()}}))}else{t.writeHead(400);t.end()}}}function readConfig(e,t,i){const s=e.readConfigFile(t,e.sys.readFile);if(s.error){throw new Error("tsconfig.json error: "+s.error.messageText)}return e.parseJsonConfigFileContent(s.config,e.sys,i,undefined,t)}function startServer(){let e=undefined;let t=18083;let s;var a=process.argv.slice(2);let o;let l;for(let s=0;s<a.length;s++){if(a[s]=="-v"||a[s]=="--version"){var c=i(306).i8;console.log(c);return}else if(a[s]=="--project"){e=a[++s]}else if(a[s]=="--port"){t=parseInt(a[++s])||t}else if(a[s]=="-f"||a[s]=="--file"){o=a[++s]}else if(a[s]=="-d"||a[s]=="--dir"){l=a[++s]}}{let i=parseInt(process.env["UNITY_PROCESS_ID"]||"0");if(i){var p=setInterval((()=>{let e=false;try{e=process.kill(i,0)}catch(t){e=t.code==="EPERM"}if(!e){console.log("no activity in the process and it terminate");process.exit(0)}}),2e3)}var u=new CompilerServer(e);u.listen(t,(e=>{if(e){console.error(e)}if(o){var t=u.buildFiles([o]);console.log(t[0].manifest);console.log(t[0].source)}else if(l){let e=[];for(const t of f.walkSync(l)){if(n.extname(t)!==".ts"){continue}e.push(t)}var t=u.buildFiles(e);console.log(t[0].manifest);console.log(t[0].source)}else{console.log("not exist initFile")}}))}}t.startServer=startServer},788:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:true});t.createTransformer=t.TransformerRemoveNode=void 0;const s=i(34);const n=i(555);const a=i(375);t.TransformerRemoveNode=Symbol("__REMOVE__");function createTransformer(e){return function(i){let o=new a.ExtensionContext(e);o.setTransformationContext(i);const visitor=e=>{o.visit(e);for(let i=0;i<n.extensions.length;i++){const s=n.extensions[i];let a=s.execute(e,o);if(a){if(a===t.TransformerRemoveNode)return null;return a}}return s.visitEachChild(e,visitor,i)};o.visitor=visitor;return e=>{e=s.visitNode(e,visitor);e=o.updateImportDeclarations(e);return e}}}t.createTransformer=createTransformer},306:e=>{e.exports={i8:"0.1.82"}},417:e=>{e.exports=require("crypto")},747:e=>{e.exports=require("fs")},605:e=>{e.exports=require("http")},282:e=>{e.exports=require("module")},622:e=>{e.exports=require("path")},34:e=>{e.exports=require("typescript")}};var __webpack_module_cache__={};function __nccwpck_require__(e){var t=__webpack_module_cache__[e];if(t!==undefined){return t.exports}var i=__webpack_module_cache__[e]={exports:{}};var s=true;try{__webpack_modules__[e](i,i.exports,__nccwpck_require__);s=false}finally{if(s)delete __webpack_module_cache__[e]}return i.exports}if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var __webpack_exports__=__nccwpck_require__(822);module.exports=__webpack_exports__})();